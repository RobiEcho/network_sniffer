# 网络抓包与流量分析工具

这是一个基于 `libpcap` 库实现的高性能网络抓包和流量统计分析工具，采用模块化设计和责任链模式处理数据包。

## 功能特点

- 高效网络数据包捕获
- 多线程并行处理
- 模块化数据结构设计
- 真正的责任链模式数据处理流程
- 精确流量统计与分析
- 灵活的数据包过滤
- 结构化日志记录

## 系统架构

### 核心数据结构

项目采用模块化设计，将原始单体数据结构拆分为多个职责单一的组件：

- **PacketContext**: 用于装载打包抓包获得的数据包已经数据包解析的状态，送进责任链递归处理
- **TrafficAnalyzer**: 记录有责任链处理过后得到的流量数据

### 设计模式与技术

- **责任链模式**: 实现真正的链式数据包处理流程，每个处理器只负责自己的任务
- **孩子兄弟树结构**: 责任链采用孩子兄弟树结构，灵活组织处理器节点
- **线程池**: 高效并行处理数据包，提高吞吐量
- **位域优化**: 使用位域高效存储解析状态标志

### 责任链处理流程

本项目实现了真正的责任链模式处理数据包，确保每个处理器只关注自己的职责：

1. **以太网解码处理器**: 解析以太网帧头部
2. **IP解码处理器**: 解析IP数据包头部
3. **TCP解码处理器**: 解析TCP段头部
4. **UDP解码处理器**: 解析UDP段头部
5. **统计处理器**: 统计流量数据

每个处理器仅处理自己层级的数据，并将结果存储在 PacketContext 的相应组件中，实现了关注点分离和单一职责原则。

## 扩展与定制

系统设计支持灵活扩展：

- 添加新的处理器节点到责任链
- 扩展数据结构以支持更多协议
- 自定义过滤规则
- 实现新的统计分析功能

## 安装与构建

### 依赖项

- libpcap-dev
- cmake (>= 3.10)
- gcc/g++ (支持C11标准)

### 构建步骤

在项目根目录执行以下命令：

```bash
mkdir build
cd build
cmake ..
make
```

构建成功后将生成可执行文件 `network_sniffer`

## 使用方法

执行：
```bash
sudo ./network_sniffer
```

程序将开始抓包和分析网络流量。按下 `Ctrl + C` 停止抓包，程序会自动生成统计报告并保存到文本文件。